{"version":3,"sources":["app.js"],"names":["angular","module","HomeCtrl","constructor","$rootScope","$scope","$timeout","componentManager","window","ComponentManager","console","log","formData","defaultHeight","tagsInputChange","$event","input","lastTag","split","slice","results","tags","filter","tag","length","content","title","startsWith","sort","a","b","showAutocomplete","highlightTag","show","setSize","document","documentElement","scrollHeight","selectTag","associateItem","highlightedTag","removeActiveTag","deassociateItem","streamItems","newTags","allTags","existing","tagCandidate","uuid","Object","assign","push","bind","streamContextItem","item","matchingReference","references","ref","activeTags","highlightNextResult","index","indexOf","highlighResultAtIndex","highlightPreviousResult","onEnter","createItem","content_type","onkeydown","handleArrowKey","e","event","keyCode","$$ngIsClass","controller"],"mappings":"AAAA;;AAEAA,QAAQC,MAAR,CAAe,KAAf,EAAsB,EAAtB,EAGC,MAAMC,QAAN,CAAe;AACdC,cAAYC,UAAZ,EAAwBC,MAAxB,EAAgCC,QAAhC,EAA0C;;AAExC,QAAIC,mBAAmB,IAAIC,OAAOC,gBAAX,EAAvB;;AAEAC,YAAQC,GAAR,CAAYJ,gBAAZ;;AAEAF,WAAOO,QAAP,GAAkB,EAAlB;AACA,QAAIC,gBAAgB,EAApB;;AAEAR,WAAOS,eAAP,GAAyB,UAASC,MAAT,EAAiB;AACxC,UAAIC,QAAQX,OAAOO,QAAP,CAAgBI,KAA5B;AACA,UAAIC,UAAUD,MAAME,KAAN,CAAY,GAAZ,EAAiBC,KAAjB,CAAuB,CAAC,CAAxB,EAA2B,CAA3B,CAAd;;AAEAd,aAAOe,OAAP,GAAiBf,OAAOgB,IAAP,CAAYC,MAAZ,CAAmB,UAASC,GAAT,EAAa;AAC/C,eAAON,QAAQO,MAAR,IAAkBD,IAAIE,OAAJ,CAAYC,KAAZ,CAAkBC,UAAlB,CAA6BV,OAA7B,CAAzB;AACD,OAFgB,EAEdW,IAFc,CAET,UAASC,CAAT,EAAYC,CAAZ,EAAc;AACpB,eAAOD,EAAEJ,OAAF,CAAUC,KAAV,GAAkBI,EAAEL,OAAF,CAAUC,KAAnC;AACD,OAJgB,CAAjB;;AAMArB,aAAO0B,gBAAP,CAAwB1B,OAAOe,OAAP,CAAeI,MAAf,GAAwB,CAAhD;AACAnB,aAAO2B,YAAP,CAAoB3B,OAAOe,OAAP,CAAe,CAAf,CAApB;AACD,KAZD;;AAcAf,WAAO0B,gBAAP,GAA0B,UAASE,IAAT,EAAe;AACvC5B,aAAOO,QAAP,CAAgBmB,gBAAhB,GAAmCE,IAAnC;;AAEA3B,eAAS,YAAU;AACjBC,yBAAiB2B,OAAjB,CAAyB,SAAzB,EAAoC,MAApC,EAA4CC,SAASC,eAAT,CAAyBC,YAArE;AACD,OAFD;AAGD,KAND;;AAQAhC,WAAOiC,SAAP,GAAmB,UAASf,GAAT,EAAc;AAC/BhB,uBAAiBgC,aAAjB,CAA+BhB,GAA/B;AACAlB,aAAO0B,gBAAP,CAAwB,KAAxB;AACA1B,aAAOO,QAAP,CAAgBI,KAAhB,GAAwB,EAAxB;AACAX,aAAOmC,cAAP,GAAwB,IAAxB;AACD,KALD;;AAOAnC,WAAOoC,eAAP,GAAyB,UAASlB,GAAT,EAAc;AACrChB,uBAAiBmC,eAAjB,CAAiCnB,GAAjC;AACD,KAFD;;AAIAhB,qBAAiBoC,WAAjB,CAA6B,UAASC,OAAT,EAAkB;AAC7CtC,eAAS,YAAU;AACjB,YAAIuC,UAAUxC,OAAOgB,IAAP,IAAe,EAA7B;AACA,aAAI,IAAIE,GAAR,IAAeqB,OAAf,EAAwB;AACtB,cAAIE,WAAWD,QAAQvB,MAAR,CAAe,UAASyB,YAAT,EAAsB;AAClD,mBAAOA,aAAaC,IAAb,KAAsBzB,IAAIyB,IAAjC;AACD,WAFc,EAEZ,CAFY,CAAf;AAGA,cAAGF,QAAH,EAAa;AACXG,mBAAOC,MAAP,CAAcJ,QAAd,EAAwBvB,GAAxB;AACD,WAFD,MAEO;AACLsB,oBAAQM,IAAR,CAAa5B,GAAb;AACD;AACF;AACDlB,eAAOgB,IAAP,GAAcwB,OAAd;AACD,OAbD;AAeD,KAhB4B,CAgB3BO,IAhB2B,CAgBtB,IAhBsB,CAA7B;;AAkBA7C,qBAAiB8C,iBAAjB,CAAmC,UAASC,IAAT,EAAc;AAC/ChD,eAAS,YAAU;AACjB,YAAIe,OAAOhB,OAAOgB,IAAP,CAAYC,MAAZ,CAAmB,UAASC,GAAT,EAAa;AACzC,cAAIgC,oBAAoBD,KAAK7B,OAAL,CAAa+B,UAAb,CAAwBlC,MAAxB,CAA+B,UAASmC,GAAT,EAAa;AAClE,mBAAOA,IAAIT,IAAJ,KAAazB,IAAIyB,IAAxB;AACD,WAFuB,EAErB,CAFqB,CAAxB;AAGA,iBAAOO,iBAAP;AACD,SALU,CAAX;;AAOAlD,eAAOqD,UAAP,GAAoBrC,KAAKO,IAAL,CAAU,UAASC,CAAT,EAAYC,CAAZ,EAAc;AAC1C,iBAAOD,EAAEJ,OAAF,CAAUC,KAAV,GAAkBI,EAAEL,OAAF,CAAUC,KAAnC;AACD,SAFmB,CAApB;AAGD,OAXD;AAYD,KAbD;;AAeArB,WAAO2B,YAAP,GAAsB,UAAST,GAAT,EAAc;AAClClB,aAAOmC,cAAP,GAAwBjB,GAAxB;AACD,KAFD;;AAIAlB,WAAOsD,mBAAP,GAA6B,YAAW;AACtC,UAAG,CAACtD,OAAOe,OAAX,EAAoB;AAClB;AACD;AACD,UAAIwC,QAAQvD,OAAOe,OAAP,CAAeyC,OAAf,CAAuBxD,OAAOmC,cAA9B,CAAZ;AACAnC,aAAOyD,qBAAP,CAA6BF,QAAQ,CAArC;AACD,KAND;;AAQAvD,WAAO0D,uBAAP,GAAiC,YAAW;AAC1C,UAAG,CAAC1D,OAAOe,OAAX,EAAoB;AAClB;AACD;AACD,UAAIwC,QAAQvD,OAAOe,OAAP,CAAeyC,OAAf,CAAuBxD,OAAOmC,cAA9B,CAAZ;AACAoB;AACA,UAAGA,QAAQ,CAAX,EAAc;AACZA,gBAAQvD,OAAOe,OAAP,CAAeI,MAAf,GAAwB,CAAhC;AACD;AACDnB,aAAOyD,qBAAP,CAA6BF,KAA7B;AACD,KAVD;;AAYAvD,WAAOyD,qBAAP,GAA+B,UAASF,KAAT,EAAgB;AAC7CvD,aAAO2B,YAAP,CAAoB3B,OAAOe,OAAP,CAAewC,QAAQvD,OAAOe,OAAP,CAAeI,MAAtC,CAApB;AACD,KAFD;;AAIAnB,WAAO2D,OAAP,GAAiB,YAAW;AAC1B,UAAG3D,OAAOmC,cAAV,EAA0B;AACxBnC,eAAOiC,SAAP,CAAiBjC,OAAOmC,cAAxB;AACD,OAFD,MAEO,IAAGnC,OAAOO,QAAP,CAAgBI,KAAnB,EAA0B;AAC/BT,yBAAiB0D,UAAjB,CAA4B,EAACC,cAAc,KAAf,EAAsBzC,SAAS,EAACC,OAAOrB,OAAOO,QAAP,CAAgBI,KAAxB,EAA/B,EAA5B;AACAX,eAAOO,QAAP,CAAgBI,KAAhB,GAAwB,EAAxB;AACD;AACF,KAPD;;AASAT,qBAAiB2B,OAAjB,CAAyB,WAAzB,EAAsC,MAAtC,EAA8CrB,aAA9C;;AAEAsB,aAASgC,SAAT,GAAqBC,cAArB;;AAEA,aAASA,cAAT,CAAwBC,CAAxB,EAA2B;AACvBA,UAAIA,KAAK7D,OAAO8D,KAAhB;AACA,UAAID,EAAEE,OAAF,IAAa,IAAjB,EAAuB;AACrB;AACAjE,iBAAS,YAAU;AACjBD,iBAAO0D,uBAAP;AACD,SAFD;AAGD,OALD,MAKO,IAAIM,EAAEE,OAAF,IAAa,IAAjB,EAAuB;AAC5B;AACAjE,iBAAS,YAAU;AACjBD,iBAAOsD,mBAAP;AACD,SAFD;AAGD;AACJ;AAEF;AApIa;;AAuIhB;AACAzD,SAASsE,WAAT,GAAuB,IAAvB;;AAEAxE,QAAQC,MAAR,CAAe,KAAf,EAAsBwE,UAAtB,CAAiC,UAAjC,EAA6CvE,QAA7C","file":"app.js","sourcesContent":["'use strict';\n\nangular.module('app', [\n\n])\n;class HomeCtrl {\n  constructor($rootScope, $scope, $timeout) {\n\n    let componentManager = new window.ComponentManager();\n\n    console.log(componentManager);\n\n    $scope.formData = {};\n    let defaultHeight = 45;\n\n    $scope.tagsInputChange = function($event) {\n      var input = $scope.formData.input;\n      var lastTag = input.split(\"#\").slice(-1)[0];\n\n      $scope.results = $scope.tags.filter(function(tag){\n        return lastTag.length && tag.content.title.startsWith(lastTag);\n      }).sort(function(a, b){\n        return a.content.title > b.content.title;\n      })\n\n      $scope.showAutocomplete($scope.results.length > 0);\n      $scope.highlightTag($scope.results[0]);\n    }\n\n    $scope.showAutocomplete = function(show) {\n      $scope.formData.showAutocomplete = show;\n\n      $timeout(function(){\n        componentManager.setSize(\"content\", \"100%\", document.documentElement.scrollHeight);\n      })\n    }\n\n    $scope.selectTag = function(tag) {\n      componentManager.associateItem(tag);\n      $scope.showAutocomplete(false);\n      $scope.formData.input = \"\";\n      $scope.highlightedTag = null;\n    }\n\n    $scope.removeActiveTag = function(tag) {\n      componentManager.deassociateItem(tag);\n    }\n\n    componentManager.streamItems(function(newTags) {\n      $timeout(function(){\n        var allTags = $scope.tags || [];\n        for(var tag of newTags) {\n          var existing = allTags.filter(function(tagCandidate){\n            return tagCandidate.uuid === tag.uuid;\n          })[0];\n          if(existing) {\n            Object.assign(existing, tag);\n          } else {\n            allTags.push(tag);\n          }\n        }\n        $scope.tags = allTags;\n      })\n\n    }.bind(this));\n\n    componentManager.streamContextItem(function(item){\n      $timeout(function(){\n        var tags = $scope.tags.filter(function(tag){\n          var matchingReference = item.content.references.filter(function(ref){\n            return ref.uuid === tag.uuid\n          })[0];\n          return matchingReference;\n        })\n\n        $scope.activeTags = tags.sort(function(a, b){\n          return a.content.title > b.content.title;\n        })\n      })\n    })\n\n    $scope.highlightTag = function(tag) {\n      $scope.highlightedTag = tag;\n    }\n\n    $scope.highlightNextResult = function() {\n      if(!$scope.results) {\n        return;\n      }\n      var index = $scope.results.indexOf($scope.highlightedTag);\n      $scope.highlighResultAtIndex(index + 1);\n    }\n\n    $scope.highlightPreviousResult = function() {\n      if(!$scope.results) {\n        return;\n      }\n      var index = $scope.results.indexOf($scope.highlightedTag);\n      index--;\n      if(index < 0) {\n        index = $scope.results.length - 1;\n      }\n      $scope.highlighResultAtIndex(index);\n    }\n\n    $scope.highlighResultAtIndex = function(index) {\n      $scope.highlightTag($scope.results[index % $scope.results.length]);\n    }\n\n    $scope.onEnter = function() {\n      if($scope.highlightedTag) {\n        $scope.selectTag($scope.highlightedTag);\n      } else if($scope.formData.input) {\n        componentManager.createItem({content_type: \"Tag\", content: {title: $scope.formData.input}});\n        $scope.formData.input = \"\";\n      }\n    }\n\n    componentManager.setSize(\"container\", \"100%\", defaultHeight);\n\n    document.onkeydown = handleArrowKey;\n\n    function handleArrowKey(e) {\n        e = e || window.event;\n        if (e.keyCode == '38') {\n          // up arrow\n          $timeout(function(){\n            $scope.highlightPreviousResult();\n          })\n        } else if (e.keyCode == '40') {\n          // down arrow\n          $timeout(function(){\n            $scope.highlightNextResult();\n          });\n        }\n    }\n\n  }\n}\n\n// required for firefox\nHomeCtrl.$$ngIsClass = true;\n\nangular.module('app').controller('HomeCtrl', HomeCtrl);\n"]}