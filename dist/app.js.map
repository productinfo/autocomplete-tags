{"version":3,"sources":["app.js"],"names":["angular","module","HomeCtrl","constructor","$rootScope","$scope","$timeout","tags","permissions","name","content_types","componentManager","window","ComponentManager","formData","defaultHeight","tagsInputChange","$event","input","lastTag","split","slice","results","filter","tag","length","content","title","startsWith","sort","a","b","showAutocomplete","highlightTag","show","setSize","document","documentElement","scrollHeight","selectTag","associateItem","highlightedTag","removeActiveTag","deassociateItem","streamItems","newTags","allTags","existing","tagCandidate","uuid","Object","assign","push","bind","streamContextItem","item","matchingReference","references","ref","activeTags","highlightNextResult","index","indexOf","highlighResultAtIndex","highlightPreviousResult","onEnter","createItem","content_type","onkeydown","handleArrowKey","e","event","keyCode","$$ngIsClass","controller"],"mappings":"AAAA;;AAEAA,QAAQC,MAAR,CAAe,KAAf,EAAsB,EAAtB,EAGC,MAAMC,QAAN,CAAe;AACdC,cAAYC,UAAZ,EAAwBC,MAAxB,EAAgCC,QAAhC,EAA0C;;AAExCD,WAAOE,IAAP,GAAc,EAAd;;AAEA,QAAIC,cAAc,CAChB;AACEC,YAAM,cADR;AAEEC,qBAAe,CAAC,KAAD;AAFjB,KADgB,EAKhB;AACED,YAAM;AADR,KALgB,CAAlB;;AAUA,QAAIE,mBAAmB,IAAIC,OAAOC,gBAAX,CAA4BL,WAA5B,EAAyC,YAAU;AACxE;AACD,KAFsB,CAAvB;;AAIAH,WAAOS,QAAP,GAAkB,EAAlB;AACA,QAAIC,gBAAgB,EAApB;;AAEAV,WAAOW,eAAP,GAAyB,UAASC,MAAT,EAAiB;AACxC,UAAIC,QAAQb,OAAOS,QAAP,CAAgBI,KAA5B;AACA,UAAIC,UAAUD,MAAME,KAAN,CAAY,GAAZ,EAAiBC,KAAjB,CAAuB,CAAC,CAAxB,EAA2B,CAA3B,CAAd;;AAEAhB,aAAOiB,OAAP,GAAiBjB,OAAOE,IAAP,CAAYgB,MAAZ,CAAmB,UAASC,GAAT,EAAa;AAC/C,eAAOL,QAAQM,MAAR,IAAkBD,IAAIE,OAAJ,CAAYC,KAAZ,CAAkBC,UAAlB,CAA6BT,OAA7B,CAAzB;AACD,OAFgB,EAEdU,IAFc,CAET,UAASC,CAAT,EAAYC,CAAZ,EAAc;AACpB,eAAOD,EAAEJ,OAAF,CAAUC,KAAV,GAAkBI,EAAEL,OAAF,CAAUC,KAAnC;AACD,OAJgB,CAAjB;;AAMAtB,aAAO2B,gBAAP,CAAwB3B,OAAOiB,OAAP,CAAeG,MAAf,GAAwB,CAAhD;AACApB,aAAO4B,YAAP,CAAoB5B,OAAOiB,OAAP,CAAe,CAAf,CAApB;AACD,KAZD;;AAcAjB,WAAO2B,gBAAP,GAA0B,UAASE,IAAT,EAAe;AACvC7B,aAAOS,QAAP,CAAgBkB,gBAAhB,GAAmCE,IAAnC;;AAEA5B,eAAS,YAAU;AACjBK,yBAAiBwB,OAAjB,CAAyB,SAAzB,EAAoC,MAApC,EAA4CC,SAASC,eAAT,CAAyBC,YAArE;AACD,OAFD;AAGD,KAND;;AAQAjC,WAAOkC,SAAP,GAAmB,UAASf,GAAT,EAAc;AAC/Bb,uBAAiB6B,aAAjB,CAA+BhB,GAA/B;AACAnB,aAAO2B,gBAAP,CAAwB,KAAxB;AACA3B,aAAOS,QAAP,CAAgBI,KAAhB,GAAwB,EAAxB;AACAb,aAAOoC,cAAP,GAAwB,IAAxB;AACD,KALD;;AAOApC,WAAOqC,eAAP,GAAyB,UAASlB,GAAT,EAAc;AACrCb,uBAAiBgC,eAAjB,CAAiCnB,GAAjC;AACD,KAFD;;AAIAb,qBAAiBiC,WAAjB,CAA6B,UAASC,OAAT,EAAkB;AAC7CvC,eAAS,YAAU;AACjB,YAAIwC,UAAUzC,OAAOE,IAAP,IAAe,EAA7B;AACA,aAAI,IAAIiB,GAAR,IAAeqB,OAAf,EAAwB;AACtB,cAAIE,WAAWD,QAAQvB,MAAR,CAAe,UAASyB,YAAT,EAAsB;AAClD,mBAAOA,aAAaC,IAAb,KAAsBzB,IAAIyB,IAAjC;AACD,WAFc,EAEZ,CAFY,CAAf;AAGA,cAAGF,QAAH,EAAa;AACXG,mBAAOC,MAAP,CAAcJ,QAAd,EAAwBvB,GAAxB;AACD,WAFD,MAEO;AACLsB,oBAAQM,IAAR,CAAa5B,GAAb;AACD;AACF;AACDnB,eAAOE,IAAP,GAAcuC,OAAd;AACD,OAbD;AAeD,KAhB4B,CAgB3BO,IAhB2B,CAgBtB,IAhBsB,CAA7B;;AAkBA1C,qBAAiB2C,iBAAjB,CAAmC,UAASC,IAAT,EAAc;AAC/CjD,eAAS,YAAU;AACjB,YAAIC,OAAOF,OAAOE,IAAP,CAAYgB,MAAZ,CAAmB,UAASC,GAAT,EAAa;AACzC,cAAIgC,oBAAoBD,KAAK7B,OAAL,CAAa+B,UAAb,CAAwBlC,MAAxB,CAA+B,UAASmC,GAAT,EAAa;AAClE,mBAAOA,IAAIT,IAAJ,KAAazB,IAAIyB,IAAxB;AACD,WAFuB,EAErB,CAFqB,CAAxB;AAGA,iBAAOO,iBAAP;AACD,SALU,CAAX;;AAOAnD,eAAOsD,UAAP,GAAoBpD,KAAKsB,IAAL,CAAU,UAASC,CAAT,EAAYC,CAAZ,EAAc;AAC1C,iBAAOD,EAAEJ,OAAF,CAAUC,KAAV,GAAkBI,EAAEL,OAAF,CAAUC,KAAnC;AACD,SAFmB,CAApB;AAGD,OAXD;AAYD,KAbD;;AAeAtB,WAAO4B,YAAP,GAAsB,UAAST,GAAT,EAAc;AAClCnB,aAAOoC,cAAP,GAAwBjB,GAAxB;AACD,KAFD;;AAIAnB,WAAOuD,mBAAP,GAA6B,YAAW;AACtC,UAAG,CAACvD,OAAOiB,OAAX,EAAoB;AAClB;AACD;AACD,UAAIuC,QAAQxD,OAAOiB,OAAP,CAAewC,OAAf,CAAuBzD,OAAOoC,cAA9B,CAAZ;AACApC,aAAO0D,qBAAP,CAA6BF,QAAQ,CAArC;AACD,KAND;;AAQAxD,WAAO2D,uBAAP,GAAiC,YAAW;AAC1C,UAAG,CAAC3D,OAAOiB,OAAX,EAAoB;AAClB;AACD;AACD,UAAIuC,QAAQxD,OAAOiB,OAAP,CAAewC,OAAf,CAAuBzD,OAAOoC,cAA9B,CAAZ;AACAoB;AACA,UAAGA,QAAQ,CAAX,EAAc;AACZA,gBAAQxD,OAAOiB,OAAP,CAAeG,MAAf,GAAwB,CAAhC;AACD;AACDpB,aAAO0D,qBAAP,CAA6BF,KAA7B;AACD,KAVD;;AAYAxD,WAAO0D,qBAAP,GAA+B,UAASF,KAAT,EAAgB;AAC7CxD,aAAO4B,YAAP,CAAoB5B,OAAOiB,OAAP,CAAeuC,QAAQxD,OAAOiB,OAAP,CAAeG,MAAtC,CAApB;AACD,KAFD;;AAIApB,WAAO4D,OAAP,GAAiB,YAAW;AAC1B,UAAG5D,OAAOoC,cAAV,EAA0B;AACxBpC,eAAOkC,SAAP,CAAiBlC,OAAOoC,cAAxB;AACD,OAFD,MAEO,IAAGpC,OAAOS,QAAP,CAAgBI,KAAnB,EAA0B;AAC/BP,yBAAiBuD,UAAjB,CAA4B,EAACC,cAAc,KAAf,EAAsBzC,SAAS,EAACC,OAAOtB,OAAOS,QAAP,CAAgBI,KAAxB,EAA/B,EAA5B;AACAb,eAAOS,QAAP,CAAgBI,KAAhB,GAAwB,EAAxB;AACD;AACF,KAPD;;AASAP,qBAAiBwB,OAAjB,CAAyB,WAAzB,EAAsC,MAAtC,EAA8CpB,aAA9C;;AAEAqB,aAASgC,SAAT,GAAqBC,cAArB;;AAEA,aAASA,cAAT,CAAwBC,CAAxB,EAA2B;AACvBA,UAAIA,KAAK1D,OAAO2D,KAAhB;AACA,UAAID,EAAEE,OAAF,IAAa,IAAjB,EAAuB;AACrB;AACAlE,iBAAS,YAAU;AACjBD,iBAAO2D,uBAAP;AACD,SAFD;AAGD,OALD,MAKO,IAAIM,EAAEE,OAAF,IAAa,IAAjB,EAAuB;AAC5B;AACAlE,iBAAS,YAAU;AACjBD,iBAAOuD,mBAAP;AACD,SAFD;AAGD;AACJ;AAEF;AAhJa;;AAmJhB;AACA1D,SAASuE,WAAT,GAAuB,IAAvB;;AAEAzE,QAAQC,MAAR,CAAe,KAAf,EAAsByE,UAAtB,CAAiC,UAAjC,EAA6CxE,QAA7C","file":"app.js","sourcesContent":["'use strict';\n\nangular.module('app', [\n\n])\n;class HomeCtrl {\n  constructor($rootScope, $scope, $timeout) {\n\n    $scope.tags = [];\n\n    var permissions = [\n      {\n        name: \"stream-items\",\n        content_types: [\"Tag\"]\n      },\n      {\n        name: \"stream-context-item\"\n      }\n    ]\n\n    let componentManager = new window.ComponentManager(permissions, function(){\n      // on ready\n    });\n\n    $scope.formData = {};\n    let defaultHeight = 45;\n\n    $scope.tagsInputChange = function($event) {\n      var input = $scope.formData.input;\n      var lastTag = input.split(\"#\").slice(-1)[0];\n\n      $scope.results = $scope.tags.filter(function(tag){\n        return lastTag.length && tag.content.title.startsWith(lastTag);\n      }).sort(function(a, b){\n        return a.content.title > b.content.title;\n      })\n\n      $scope.showAutocomplete($scope.results.length > 0);\n      $scope.highlightTag($scope.results[0]);\n    }\n\n    $scope.showAutocomplete = function(show) {\n      $scope.formData.showAutocomplete = show;\n\n      $timeout(function(){\n        componentManager.setSize(\"content\", \"100%\", document.documentElement.scrollHeight);\n      })\n    }\n\n    $scope.selectTag = function(tag) {\n      componentManager.associateItem(tag);\n      $scope.showAutocomplete(false);\n      $scope.formData.input = \"\";\n      $scope.highlightedTag = null;\n    }\n\n    $scope.removeActiveTag = function(tag) {\n      componentManager.deassociateItem(tag);\n    }\n\n    componentManager.streamItems(function(newTags) {\n      $timeout(function(){\n        var allTags = $scope.tags || [];\n        for(var tag of newTags) {\n          var existing = allTags.filter(function(tagCandidate){\n            return tagCandidate.uuid === tag.uuid;\n          })[0];\n          if(existing) {\n            Object.assign(existing, tag);\n          } else {\n            allTags.push(tag);\n          }\n        }\n        $scope.tags = allTags;\n      })\n\n    }.bind(this));\n\n    componentManager.streamContextItem(function(item){\n      $timeout(function(){\n        var tags = $scope.tags.filter(function(tag){\n          var matchingReference = item.content.references.filter(function(ref){\n            return ref.uuid === tag.uuid\n          })[0];\n          return matchingReference;\n        })\n\n        $scope.activeTags = tags.sort(function(a, b){\n          return a.content.title > b.content.title;\n        })\n      })\n    })\n\n    $scope.highlightTag = function(tag) {\n      $scope.highlightedTag = tag;\n    }\n\n    $scope.highlightNextResult = function() {\n      if(!$scope.results) {\n        return;\n      }\n      var index = $scope.results.indexOf($scope.highlightedTag);\n      $scope.highlighResultAtIndex(index + 1);\n    }\n\n    $scope.highlightPreviousResult = function() {\n      if(!$scope.results) {\n        return;\n      }\n      var index = $scope.results.indexOf($scope.highlightedTag);\n      index--;\n      if(index < 0) {\n        index = $scope.results.length - 1;\n      }\n      $scope.highlighResultAtIndex(index);\n    }\n\n    $scope.highlighResultAtIndex = function(index) {\n      $scope.highlightTag($scope.results[index % $scope.results.length]);\n    }\n\n    $scope.onEnter = function() {\n      if($scope.highlightedTag) {\n        $scope.selectTag($scope.highlightedTag);\n      } else if($scope.formData.input) {\n        componentManager.createItem({content_type: \"Tag\", content: {title: $scope.formData.input}});\n        $scope.formData.input = \"\";\n      }\n    }\n\n    componentManager.setSize(\"container\", \"100%\", defaultHeight);\n\n    document.onkeydown = handleArrowKey;\n\n    function handleArrowKey(e) {\n        e = e || window.event;\n        if (e.keyCode == '38') {\n          // up arrow\n          $timeout(function(){\n            $scope.highlightPreviousResult();\n          })\n        } else if (e.keyCode == '40') {\n          // down arrow\n          $timeout(function(){\n            $scope.highlightNextResult();\n          });\n        }\n    }\n\n  }\n}\n\n// required for firefox\nHomeCtrl.$$ngIsClass = true;\n\nangular.module('app').controller('HomeCtrl', HomeCtrl);\n"]}