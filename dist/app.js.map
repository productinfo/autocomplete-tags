{"version":3,"sources":["app.js"],"names":["angular","module","HomeCtrl","constructor","$rootScope","$scope","$timeout","tags","delimitter","permissions","name","content_types","componentManager","window","ComponentManager","formData","defaultHeight","tagsInputChange","$event","input","lastTag","split","slice","results","filter","tag","comps","content","title","comp","length","startsWith","sort","a","b","showAutocomplete","highlightTag","show","setSize","document","documentElement","scrollHeight","selectTag","index","tagName","join","_tag","candidate","associateItem","highlightedTag","removeActiveTag","deassociateItem","streamItems","newTags","allTags","existing","tagCandidate","uuid","Object","assign","push","bind","streamContextItem","item","matchingReference","references","ref","activeTags","highlightNextResult","indexOf","highlighResultAtIndex","highlightPreviousResult","onEnter","createItem","content_type","onkeydown","handleArrowKey","e","event","keyCode","$$ngIsClass","controller"],"mappings":"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","file":"app.js","sourcesContent":["'use strict';\n\nangular.module('app', [\n\n])\n;class HomeCtrl {\n  constructor($rootScope, $scope, $timeout) {\n\n    $scope.tags = [];\n\n    var delimitter = \".\";\n\n    var permissions = [\n      {\n        name: \"stream-items\",\n        content_types: [\"Tag\"]\n      },\n      {\n        name: \"stream-context-item\"\n      }\n    ]\n\n    let componentManager = new window.ComponentManager(permissions, function(){\n      // on ready\n    });\n\n    $scope.formData = {};\n    let defaultHeight = 50;\n\n    $scope.tagsInputChange = function($event) {\n      var input = $scope.formData.input;\n\n      var lastTag = input.split(\"#\").slice(-1)[0];\n      if(lastTag) {\n        $scope.results = $scope.tags.filter(function(tag){\n          var comps = tag.content.title.split(delimitter);\n          for(var comp of comps) {\n            if(comp.length && comp.startsWith(lastTag)) {\n              return true;\n            }\n          }\n          return tag.content.title.startsWith(lastTag);\n        }).sort(function(a, b){\n          return a.content.title > b.content.title;\n        })\n      } else {\n        $scope.results = [];\n      }\n\n      $scope.showAutocomplete($scope.results.length > 0);\n      $scope.highlightTag($scope.results[0]);\n    }\n\n    $scope.showAutocomplete = function(show) {\n      $scope.formData.showAutocomplete = show;\n\n      $timeout(function(){\n        componentManager.setSize(\"content\", \"100%\", document.documentElement.scrollHeight);\n      })\n    }\n\n    $scope.selectTag = function(tag) {\n      var comps = tag.content.title.split(delimitter);\n      for(var index = 1; index < comps.length + 1; index++) {\n        var tagName = comps.slice(0, index).join(delimitter);\n        var _tag = $scope.tags.filter(function(candidate){\n          return candidate.content.title === tagName;\n        })[0]\n\n        componentManager.associateItem(_tag);\n      }\n\n      $scope.showAutocomplete(false);\n      $scope.formData.input = \"\";\n      $scope.highlightedTag = null;\n    }\n\n    $scope.removeActiveTag = function(tag) {\n      componentManager.deassociateItem(tag);\n    }\n\n    componentManager.streamItems(function(newTags) {\n      $timeout(function(){\n        var allTags = $scope.tags || [];\n        for(var tag of newTags) {\n          var existing = allTags.filter(function(tagCandidate){\n            return tagCandidate.uuid === tag.uuid;\n          })[0];\n          if(existing) {\n            Object.assign(existing, tag);\n          } else {\n            allTags.push(tag);\n          }\n        }\n        $scope.tags = allTags;\n      })\n\n    }.bind(this));\n\n    componentManager.streamContextItem(function(item){\n      $timeout(function(){\n        var tags = $scope.tags.filter(function(tag){\n          var matchingReference = item.content.references.filter(function(ref){\n            return ref.uuid === tag.uuid\n          })[0];\n          return matchingReference;\n        })\n\n        $scope.activeTags = tags.sort(function(a, b){\n          return a.content.title > b.content.title;\n        })\n      })\n    })\n\n    $scope.highlightTag = function(tag) {\n      $scope.highlightedTag = tag;\n    }\n\n    $scope.highlightNextResult = function() {\n      if(!$scope.results) {\n        return;\n      }\n      var index = $scope.results.indexOf($scope.highlightedTag);\n      $scope.highlighResultAtIndex(index + 1);\n    }\n\n    $scope.highlightPreviousResult = function() {\n      if(!$scope.results) {\n        return;\n      }\n      var index = $scope.results.indexOf($scope.highlightedTag);\n      index--;\n      if(index < 0) {\n        index = $scope.results.length - 1;\n      }\n      $scope.highlighResultAtIndex(index);\n    }\n\n    $scope.highlighResultAtIndex = function(index) {\n      $scope.highlightTag($scope.results[index % $scope.results.length]);\n    }\n\n    $scope.onEnter = function() {\n      if($scope.highlightedTag) {\n        $scope.selectTag($scope.highlightedTag);\n      } else if($scope.formData.input) {\n        componentManager.createItem({content_type: \"Tag\", content: {title: $scope.formData.input}});\n        $scope.formData.input = \"\";\n      }\n    }\n\n    componentManager.setSize(\"container\", \"100%\", defaultHeight);\n\n    document.onkeydown = handleArrowKey;\n\n    function handleArrowKey(e) {\n        e = e || window.event;\n        if (e.keyCode == '38') {\n          // up arrow\n          $timeout(function(){\n            $scope.highlightPreviousResult();\n          })\n        } else if (e.keyCode == '40') {\n          // down arrow\n          $timeout(function(){\n            $scope.highlightNextResult();\n          });\n        }\n    }\n\n  }\n}\n\n// required for firefox\nHomeCtrl.$$ngIsClass = true;\n\nangular.module('app').controller('HomeCtrl', HomeCtrl);\n"]}