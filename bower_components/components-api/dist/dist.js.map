{"version":3,"sources":["../src/componentManager.js"],"names":["ComponentManager","constructor","loggingEnabled","sentMessages","messageQueue","window","addEventListener","event","console","log","data","handleMessage","bind","payload","action","sessionKey","onReady","original","originalMessage","filter","message","messageId","callback","postMessage","push","generateUUID","api","sentMessage","JSON","parse","stringify","parent","setSize","type","width","height","streamItems","content_types","tags","items","streamReferences","references","tagRefs","ref","content_type","selectItem","item","jsonObjectForItem","createItem","associateItem","deassociateItem","clearSelection","deleteItem","saveItem","saveItems","map","copy","Object","assign","children","crypto","msCrypto","buf","Uint32Array","getRandomValues","idx","replace","c","r","v","toString","d","Date","getTime","performance","now","uuid","Math","random","floor"],"mappings":"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","file":"dist.js","sourcesContent":["class ComponentManager {\n\n  constructor(loggingEnabled) {\n    this.sentMessages = [];\n    this.messageQueue = [];\n\n    window.addEventListener(\"message\", function(event){\n      if(loggingEnabled) {\n        console.log(\"Components API Message received:\", event.data);\n      }\n      this.handleMessage(event.data);\n    }.bind(this), false);\n  }\n\n  handleMessage(payload) {\n    if(payload.action === \"component-registered\") {\n      this.sessionKey = payload.sessionKey;\n      this.onReady();\n    }\n\n    else if(payload.original) {\n      // get callback from queue\n      var originalMessage = this.sentMessages.filter(function(message){\n        return message.messageId === payload.original.messageId;\n      })[0];\n\n      if(originalMessage.callback) {\n        originalMessage.callback(payload.data);\n      }\n    }\n  }\n\n  onReady() {\n    for(var message of this.messageQueue) {\n      this.postMessage(message.action, message.data, message.callback);\n    }\n    this.messageQueue = [];\n  }\n\n  postMessage(action, data, callback) {\n    if(!this.sessionKey) {\n      this.messageQueue.push({\n        action: action,\n        data: data,\n        callback: callback\n      });\n      return;\n    }\n\n    var message = {\n      action: action,\n      data: data,\n      messageId: this.generateUUID(),\n      sessionKey: this.sessionKey,\n      api: \"component\"\n    }\n\n    var sentMessage = JSON.parse(JSON.stringify(message));\n    sentMessage.callback = callback;\n    this.sentMessages.push(sentMessage);\n\n    window.parent.postMessage(message, '*');\n  }\n\n  setSize(type, width, height) {\n    this.postMessage(\"set-size\", {type: type, width: width, height: height}, function(data){\n\n    })\n  }\n\n  streamItems(callback) {\n    this.postMessage(\"stream-items\", {content_types: [\"Tag\"]}, function(data){\n      var tags = data.items;\n      callback(tags);\n    }.bind(this));\n  }\n\n  streamReferences(callback) {\n    this.postMessage(\"stream-references\", {}, function(data){\n      var references = data.references;\n      var tagRefs = references.filter(function(ref){\n        return ref.content_type === \"Tag\";\n      })\n      callback(tagRefs);\n    }.bind(this));\n  }\n\n  selectItem(item) {\n    this.postMessage(\"select-item\", {item: this.jsonObjectForItem(item)});\n  }\n\n  createItem(item) {\n    this.postMessage(\"create-item\", {item: this.jsonObjectForItem(item)}, function(data){\n      var item = data.item;\n      this.associateItem(item);\n    }.bind(this));\n  }\n\n  associateItem(item) {\n    this.postMessage(\"associate-item\", {item: this.jsonObjectForItem(item)});\n  }\n\n  deassociateItem(item) {\n    this.postMessage(\"deassociate-item\", {item: this.jsonObjectForItem(item)});\n  }\n\n  clearSelection() {\n    this.postMessage(\"clear-selection\", {content_type: \"Tag\"});\n  }\n\n  deleteItem(item) {\n    this.postMessage(\"delete-item\", {item: this.jsonObjectForItem(item)});\n  }\n\n\n  saveItem(item) {\n    this.saveItems[item];\n  }\n\n  saveItems(items) {\n    items = items.map(function(item) {\n      return this.jsonObjectForItem(item);\n    }.bind(this));\n\n    this.postMessage(\"save-items\", {items: items}, function(data){\n\n    });\n  }\n\n  jsonObjectForItem(item) {\n    var copy = Object.assign({}, item);\n    copy.children = null;\n    copy.parent = null;\n    return copy;\n  }\n\n  generateUUID() {\n    var crypto = window.crypto || window.msCrypto;\n    if(crypto) {\n      var buf = new Uint32Array(4);\n      crypto.getRandomValues(buf);\n      var idx = -1;\n      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n          idx++;\n          var r = (buf[idx>>3] >> ((idx%8)*4))&15;\n          var v = c == 'x' ? r : (r&0x3|0x8);\n          return v.toString(16);\n      });\n    } else {\n      var d = new Date().getTime();\n      if(window.performance && typeof window.performance.now === \"function\"){\n        d += performance.now(); //use high-precision timer if available\n      }\n      var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n        var r = (d + Math.random()*16)%16 | 0;\n        d = Math.floor(d/16);\n        return (c=='x' ? r : (r&0x3|0x8)).toString(16);\n      });\n      return uuid;\n    }\n  }\n}\n\nwindow.ComponentManager = ComponentManager;\n"]}